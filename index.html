<!DOCTYPE html>
<html>

<head>
    <title>Calendrier Poste</title>

    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="manifest" href="/chemin/vers/manifest.json">


    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apis.google.com/js/api.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body>
     <p id="dateAujourdhui"></p>
    <h1>Calendrier des Postes</h1>
<div id="pageCalendrier">
    <label for="equipeSelect">SÃ©lectionnez une Ã©quipe :</label>
    <select id="equipeSelect" onchange="chargerEquipe()">
        <option value="equipeA">Ã‰quipe A</option>
        <option value="equipeB">Ã‰quipe B</option>
        <option value="equipeC"selected>Ã‰quipe C</option>
        <option value="equipeD">Ã‰quipe D</option>
        <option value="equipeE">Ã‰quipe E</option>
    </select>

    <label for="Jour">SÃ©lectionnez une date :</label>
    <select id="Jour" onchange="afficherPoste()"></select>
    <br>
    <label for="posteInput">Info :</label>
    <input type="text" id="posteInput" readonly>
  
    <button onclick="ouvrirLien('https://github.com/zaf57/Calendrier-poste/blob/main/calendrier-2023.jpg?raw=true')">Calendrier<br>2023</button>
    <button onclick="ouvrirLien('https://github.com/zaf57/Calendrier-poste/blob/main/calendrier-2024.jpg?raw=true')">Calendrier<br>2024</button>
    <button onclick="ouvrirLien('https://github.com/zaf57/Calendrier-poste/blob/main/calendrier-2025.jpg?raw=true')">Calendrier<br>2025</button>
    <button onclick="ouvrirLien('https://github.com/zaf57/Calendrier-poste/blob/main/calendrier-2026.jpg?raw=true')">Calendrier<br>2026</button>

<!-- Bouton "Data" -->
<a href="login.html" target="_blank">
    <button style="margin-top: 12px;">ðŸ”‘ Data</button>
</a>
  
    <button onclick="afficherPage('reveil')"style="padding-bottom: 9px;padding-top: 9px;padding-left: 9px;padding-right: 9px;">RÃ©veil</button>
    <button id="installButton">Installer l'application</button>
</div>

    <!-- Nouvelle page (rÃ©veil) -->
    <div id="pageReveil" style="display: none;">
        <h1>RÃ©veil</h1>
        <label for="heureReveil">Heure du rÃ©veil :</label>
        <input type="number" id="heureReveil" min="0" max="23" placeholder="Heure">
        <label for="minutesReveil">Minutes :</label>
        <input type="number" id="minutesReveil" min="0" max="59" placeholder="Minutes">
        <audio id="sonnerie" src="Alarm.mp3" loop></audio>
        <button onclick="demarrerReveil()">DÃ©marrer le RÃ©veil</button>
        <button onclick="arreterSonnerie()">ArrÃªter la Sonnerie</button>
       <button onclick="afficherPage('calendrier')" style="margin-top: 5px; ">Retour au Calendrier</button>
    </div>



    <script>
        var correspondances = {};
        var equipeSelectionnee = "equipeC"; // Par dÃ©faut, sÃ©lectionnez l'Ã©quipe ('1

        function start() {
            gapi.client.init({
                'apiKey': 'AIzaSyAIRpStG7VNS7XKpYmxunpO5hIsdZ_9d0E',
                'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(function () {
                console.log('API initialized');
                chargerEquipe();
                afficherDateAujourdhui();
            }, function (error) {
                console.log('Error initializing API', error);
            });
        }

        function chargerEquipe() {
            // Mettez Ã  jour la variable d'Ã©quipe sÃ©lectionnÃ©e en fonction de la sÃ©lection de l'utilisateur
            equipeSelectionnee = document.getElementById("equipeSelect").value;
            chargerCorrespondances();
        }

function chargerCorrespondances() {
    var spreadsheetId = "1gm-uxD8_wMvs7B12o9-hNKpehVwriWNepvVS1QxplAw";
    var sheetName = (equipeSelectionnee === "equipeA") ? "EquipeA" :
                    (equipeSelectionnee === "equipeB") ? "EquipeB" :
                    (equipeSelectionnee === "equipeC") ? "EquipeC" : 
                    (equipeSelectionnee === "equipeD") ? "EquipeD" : 
                    (equipeSelectionnee === "equipeE") ? "EquipeE" : "";

    var range = sheetName + "!A2:E";

    gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: spreadsheetId,
        range: range,
    }).then(function(response) {
        var values = response.result.values;
        correspondances = {};
        var select = document.getElementById("Jour");
        select.innerHTML = ""; // Efface toutes les options actuelles

        if (values && values.length > 0) {
            for (var i = 0; i < values.length; i++) {
                var row = values[i];
                var optionText = " [S " + row[2] + " ] " + row[0] +  " " + row[1] + " en " + row[3];
                ajouterOption("Jour", optionText, row[1], row[4]);
                correspondances[row[1]] = { jourSemaine: row[0], semaine: row[2], poste: row[3], information: row[4] };
            }
        }
                // SÃ©lectionnez la premiÃ¨re date par dÃ©faut
        var premiereDate = values[0][1];
        document.getElementById("Jour").value = premiereDate;

        // Affichez l'information correspondante
        afficherPoste();
    }, function(response) {
        console.log('Erreur : ' + response.result.error.message);
    });
}




        function ajouterOption(idSelect, texte, date, information) {
            var select = document.getElementById(idSelect);
            var option = document.createElement("option");

            // Ajoutez l'option au select
            option.text = texte;
            option.value = date;
            select.add(option);
            // Ajoutez l'information dans un attribut de donnÃ©es (dataset) de l'option
            option.dataset.information = information;
        }

function afficherPoste() {
    var dateSelectionnee = document.getElementById("Jour").value;
    var posteInput = document.getElementById("posteInput");

    //console.log("Date sÃ©lectionnÃ©e : ", dateSelectionnee);
    //console.log("Correspondances : ", correspondances);

    if (correspondances.hasOwnProperty(dateSelectionnee)) {
        var info = correspondances[dateSelectionnee];
        //console.log("Information trouvÃ©e : ", info);
        posteInput.value = info.information ? info.information : "";
    } else {
        //console.log("Aucune information trouvÃ©e pour cette date");
        posteInput.value = "Aucune information trouvÃ©e pour cette date";
    }
}


        window.onload = function() {
            gapi.load('client', start);
        };
      
     
        // Fonction pour ouvrir le lien dans une nouvelle fenÃªtre
        function ouvrirLien(lien) {
       //window.location.href = lien;
                      // Ouvrir le lien dans une nouvelle fenÃªtre centrÃ©e en bas de la page
            window.open(lien, "_blank", "width=800,height=600,top=screen.height-600");
}
    
         
 function afficherDateAujourdhui() {
        // RÃ©cupÃ©rez l'Ã©lÃ©ment oÃ¹ vous souhaitez afficher la date
        var dateAujourdhuiElement = document.getElementById("dateAujourdhui");

        // CrÃ©ez un nouvel objet Date pour la date actuelle
        var dateAujourdhui = new Date();

        // Formattez la date comme vous le souhaitez
        var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        var dateFormatee = dateAujourdhui.toLocaleDateString('fr-FR', options);

        // Affichez la date dans l'Ã©lÃ©ment
        dateAujourdhuiElement.textContent = "ðŸ“… " + dateFormatee;
    }

function activerSon() {
    sonnerie.play().then(() => {
        console.log("Son activÃ© avec succÃ¨s");
    }).catch(error => {
        console.error("Erreur lors de l'activation du son :", error.message);
    });
}

              // Fonction pour basculer entre les pages
        function afficherPage(page) {
            if (page === "calendrier") {
                document.getElementById("pageCalendrier").style.display = "block";
                document.getElementById("pageReveil").style.display = "none";
            } else if (page === "reveil") {
                document.getElementById("pageCalendrier").style.display = "none";
                document.getElementById("pageReveil").style.display = "block";
            }
        }

var sonnerie = document.getElementById("sonnerie");
var differenceTemps;

function demarrerReveil() {
    // RÃ©cupÃ©rez l'heure actuelle
    var heureActuelle = new Date().getHours();
    var minutesActuelles = new Date().getMinutes();

    // RÃ©cupÃ©rez les valeurs saisies par l'utilisateur
    var heureReveil = document.getElementById("heureReveil").value;
    var minutesReveil = document.getElementById("minutesReveil").value;

    // VÃ©rifiez si les valeurs saisies sont valides
    if (heureReveil === "" || isNaN(heureReveil) || heureReveil < 0 || heureReveil > 23) {
        alert("Veuillez entrer une heure valide (entre 0 et 23).");
        return;
    }

    if (minutesReveil === "" || isNaN(minutesReveil) || minutesReveil < 0 || minutesReveil > 59) {
        alert("Veuillez entrer des minutes valides (entre 0 et 59).");
        return;
    }
      alert("Programmer rÃ©veil ?" + heureReveil + ":" + (minutesReveil < 10 ? "0" : "") + minutesReveil);


    // Calculez la diffÃ©rence en millisecondes entre l'heure actuelle et l'heure du rÃ©veil
    var differenceTemps = new Date().setHours(heureReveil, minutesReveil, 0) - new Date();
    console.log("Date actuelle :", new Date());
    console.log("Heure du rÃ©veil :", heureReveil + ":" + (minutesReveil < 10 ? "0" : "") + minutesReveil);
    console.log("differenceTemps :", differenceTemps);
    // DÃ©marrez le rÃ©veil aprÃ¨s la diffÃ©rence de temps calculÃ©e
    setTimeout(function() {
        // DÃ©marrez la sonnerie
        activerSon();
        // Ajoutez ici le code que vous souhaitez exÃ©cuter lorsque le rÃ©veil se dÃ©clenche
        alert("REVEIL TOI BORDEL! Il est" + heureReveil + ":" + (minutesReveil < 10 ? "0" : "") + minutesReveil);
    }, differenceTemps);
}

// ArrÃªtez la sonnerie
function arreterSonnerie() {
    sonnerie.pause();
    sonnerie.currentTime = 0;
}

//bouton d'installation ou raccourci
const installButton = document.getElementById('installButton');

window.addEventListener('beforeinstallprompt', (event) => {
  // EmpÃªche l'Ã©vÃ©nement par dÃ©faut
  event.preventDefault();
  
  // Affiche le button
  installButton.style.display = 'block';
  
  // GÃ¨re l'installation lorsque le bouton est cliquÃ©
  installButton.addEventListener('click', () => {
    event.prompt();
    installButton.style.display = 'none';
  });
});


      
 

    </script>
</body>

</html>
